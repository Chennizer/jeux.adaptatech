<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Num√©ros Magiques</title>
  <style>
    :root {
      --primary: #FF6B6B;
      --secondary: #4ECDC4;
      --background: #F9F9F9;
      --text: #2D3748;
    }

    body {
      margin: 0;
      font-family: 'Arial Rounded MT Bold', sans-serif;
      background: var(--background);
      touch-action: manipulation;
    }

    .game-container {
      padding: 20px;
      max-width: 900px;
      margin: 0 auto;
    }

    .mode-selector {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-bottom: 20px;
    }

    .mode-btn {
      padding: 15px;
      border: none;
      border-radius: 15px;
      background: white;
      box-shadow: 0 3px 6px rgba(0,0,0,0.1);
      font-size: 1.2rem;
      color: var(--text);
      cursor: pointer;
      transition: transform 0.2s;
    }

    .mode-btn:active {
      transform: scale(0.95);
    }

    .activity-area {
      min-height: 60vh;
      background: white;
      border-radius: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      padding: 20px;
      position: relative;
    }

    .number-card {
      width: 120px;
      height: 120px;
      background: var(--secondary);
      border-radius: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3rem;
      color: white;
      margin: 10px;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    .number-card:active {
      transform: scale(0.95);
    }

    .counting-items {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
    }

    .counting-item {
      width: 60px;
      height: 60px;
      background: var(--primary);
      border-radius: 15px;
      cursor: pointer;
      animation: float 3s ease-in-out infinite;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    .progress-container {
      position: absolute;
      bottom: 20px;
      left: 20px;
      right: 20px;
      height: 10px;
      background: #eee;
      border-radius: 5px;
    }

    .progress-bar {
      height: 100%;
      background: var(--secondary);
      border-radius: 5px;
      transition: width 0.3s ease;
    }

    .settings {
      position: fixed;
      top: 20px;
      right: 20px;
      display: flex;
      gap: 10px;
    }

    .settings-btn {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: white;
      border: none;
      box-shadow: 0 3px 6px rgba(0,0,0,0.1);
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="game-container">
    <div class="mode-selector">
      <button class="mode-btn" data-mode="count">Compter</button>
      <button class="mode-btn" data-mode="match">Associer</button>
      <button class="mode-btn" data-mode="sequence">Ordonner</button>
    </div>

    <div class="activity-area" id="activityArea">
      <!-- Activity content will be injected here -->
      <div class="progress-container">
        <div class="progress-bar" style="width: 0%"></div>
      </div>
    </div>

    <div class="settings">
      <button class="settings-btn" id="soundBtn">üîä</button>
      <button class="settings-btn" id="helpBtn">‚ùì</button>
    </div>
  </div>

  <script>
    class NumberGame {
      constructor() {
        this.currentMode = 'count';
        this.currentNumber = 1;
        this.maxNumber = 5;
        this.isSoundOn = true;
        this.initialize();
      }

      initialize() {
        this.setupEventListeners();
        this.loadActivity();
      }

      setupEventListeners() {
        document.querySelectorAll('.mode-btn').forEach(btn => {
          btn.addEventListener('click', () => this.setMode(btn.dataset.mode));
        });

        document.getElementById('soundBtn').addEventListener('click', () => {
          this.isSoundOn = !this.isSoundOn;
          document.getElementById('soundBtn').textContent = this.isSoundOn ? 'üîä' : 'üîá';
        });

        document.getElementById('helpBtn').addEventListener('click', () => {
          this.speakInstruction();
        });
      }

      setMode(mode) {
        this.currentMode = mode;
        this.loadActivity();
      }

      loadActivity() {
        const area = document.getElementById('activityArea');
        area.innerHTML = '';
        
        switch(this.currentMode) {
          case 'count':
            this.createCountingActivity();
            break;
          case 'match':
            this.createMatchingActivity();
            break;
          case 'sequence':
            this.createSequencingActivity();
            break;
        }
      }

      createCountingActivity() {
        const container = document.createElement('div');
        container.className = 'counting-items';
        
        // Create interactive items to count
        for(let i = 0; i < this.currentNumber; i++) {
          const item = document.createElement('div');
          item.className = 'counting-item';
          item.addEventListener('click', () => this.handleCountInteraction());
          container.appendChild(item);
        }

        // Create number cards
        const numbers = Array.from({length: this.maxNumber}, (_, i) => i + 1);
        numbers.forEach(num => {
          const card = document.createElement('div');
          card.className = 'number-card';
          card.textContent = num;
          card.addEventListener('click', () => this.checkCount(num));
          container.appendChild(card);
        });

        this.activityArea.appendChild(container);
      }

      createMatchingActivity() {
        const container = document.createElement('div');
        container.className = 'counting-items';
        
        // Create pairs (number + quantity)
        const numbers = this.shuffleArray([...Array(this.maxNumber).keys()].map(n => n + 1));
        const quantities = [...numbers];

        numbers.forEach(num => {
          const card = document.createElement('div');
          card.className = 'number-card';
          card.textContent = num;
          card.dataset.value = num;
          card.addEventListener('click', (e) => this.handleMatch(e.target));
          container.appendChild(card);
        });

        quantities.forEach(qty => {
          const card = document.createElement('div');
          card.className = 'number-card';
          card.innerHTML = this.createDots(qty);
          card.dataset.value = qty;
          card.addEventListener('click', (e) => this.handleMatch(e.target));
          container.appendChild(card);
        });

        this.activityArea.appendChild(container);
      }

      createSequencingActivity() {
        const container = document.createElement('div');
        container.className = 'counting-items';
        
        const numbers = this.shuffleArray([...Array(this.maxNumber).keys()].map(n => n + 1));
        numbers.forEach(num => {
          const card = document.createElement('div');
          card.className = 'number-card';
          card.textContent = num;
          card.draggable = true;
          card.addEventListener('dragstart', (e) => this.handleDragStart(e));
          card.addEventListener('click', () => this.handleNumberPlacement(num));
          container.appendChild(card);
        });

        const numberLine = document.createElement('div');
        numberLine.className = 'number-line';
        this.activityArea.appendChild(numberLine);
        this.activityArea.appendChild(container);
      }

      handleCountInteraction() {
        if(this.isSoundOn) this.playSound('pop');
        if(navigator.vibrate) navigator.vibrate(50);
      }

      checkCount(selectedNumber) {
        if(selectedNumber === this.currentNumber) {
          this.currentNumber++;
          this.updateProgress((this.currentNumber-1)/this.maxNumber);
          if(this.currentNumber > this.maxNumber) this.showCelebration();
          this.loadActivity();
        }
      }

      handleMatch(card) {
        const selected = document.querySelectorAll('.selected');
        
        if(selected.length === 1) {
          const firstCard = selected[0];
          if(firstCard.dataset.value === card.dataset.value) {
            firstCard.classList.add('matched');
            card.classList.add('matched');
            this.playSound('success');
            this.updateProgress(0.1);
          } else {
            this.playSound('error');
          }
          selected.forEach(c => c.classList.remove('selected'));
        } else {
          card.classList.add('selected');
        }
      }

      showCelebration() {
        // Add your celebration animation here
        alert('Bravo ! Tu as r√©ussi !');
        this.currentNumber = 1;
        this.updateProgress(0);
      }

      createDots(number) {
        return Array(number).fill('<div class="dot"></div>').join('');
      }

      playSound(type) {
        const sounds = {
          pop: 'sounds/pop.mp3',
          success: 'sounds/success.mp3',
          error: 'sounds/error.mp3'
        };
        if(this.isSoundOn) new Audio(sounds[type]).play();
      }

      speakInstruction() {
        const instructions = {
          count: "Touchez les objets et s√©lectionnez le bon num√©ro",
          match: "Trouvez les paires correspondantes",
          sequence: "Placez les nombres dans le bon ordre"
        };
        const speech = new SpeechSynthesisUtterance(instructions[this.currentMode]);
        speech.lang = 'fr-FR';
        window.speechSynthesis.speak(speech);
      }

      updateProgress(percentage) {
        document.querySelector('.progress-bar').style.width = `${percentage * 100}%`;
      }

      shuffleArray(array) {
        return array.sort(() => Math.random() - 0.5);
      }
    }

    // Initialize game when loaded
    window.addEventListener('load', () => new NumberGame());
  </script>
</body>
</html>