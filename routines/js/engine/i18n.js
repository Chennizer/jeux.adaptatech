const I18N = (() => {
  const strings = {
    fr: {
      hello: "Bonjour",
      attendance: "Présence",
      transitions: "Transitions",
      now: "Maintenant",
      next: "Après",
      advance: "Avancer",
      allDone: "Terminé",
      edit: "Éditer",
      save: "Enregistrer",
      import: "Importer",
      export: "Exporter",
      back: "Retour",
      dwell: "Maintien",
      touch: "Toucher",
      volume: "Volume",
      mute: "Silence",
      language: "Langue",
      input: "Entrée",
      calmBreak: "Pause calme",
      routineEngine: "Routine",
      helloAttendanceTitle: "Bonjour / Présence",
      transitionsTitle: "Transitions",
      scheduleTitle: "Planning",
      editTitle: "Édition",
      addStudent: "Ajouter un élève",
      addSchedule: "Ajouter une étape",
      addTransition: "Ajouter une transition",
      saved: "Enregistré",
      helloScene: "Bonjour, {name}!",
      attendanceState: {
        unknown: "?",
        present: "Présent",
        absent: "Absent"
      },
      transitionPanel: "Panneau de transition",
      nowNextTitle: "Maintenant / Ensuite",
      add: "Ajouter",
      delete: "Supprimer",
      schedule: "Planning",
      students: "Élèves",
      transitionsEdit: "Transitions",
      dwellTime: "Durée maintien",
      modeTouch: "Mode tactile",
      modeDwell: "Mode regard",
      helloMode: "Bonjour",
      attendanceMode: "Présence",
      tapAnywhere: "Toucher pour avancer",
      reset: "Réinitialiser",
      confirmExit: "Quitter sans enregistrer ?",
      toggle: "Bascule",
      momentary: "Momentané",
      durationMs: "Durée (ms)",
      audio: "Audio",
      label: "Label",
      behavior: "Comportement",
      nowLabel: "Maintenant",
      nextLabel: "Ensuite",
      advanceAction: "Avancer",
      calmMessage: "Respirons ensemble",
      break: "Pause"
    },
    en: {
      hello: "Hello",
      attendance: "Attendance",
      transitions: "Transitions",
      now: "Now",
      next: "Next",
      advance: "Advance",
      allDone: "All done",
      edit: "Edit",
      save: "Save",
      import: "Import",
      export: "Export",
      back: "Back",
      dwell: "Dwell",
      touch: "Touch",
      volume: "Volume",
      mute: "Mute",
      language: "Language",
      input: "Input",
      calmBreak: "Calm Break",
      routineEngine: "Routine Engine",
      helloAttendanceTitle: "Hello / Attendance",
      transitionsTitle: "Transitions",
      scheduleTitle: "Schedule",
      editTitle: "Edit",
      addStudent: "Add student",
      addSchedule: "Add step",
      addTransition: "Add transition",
      saved: "Saved",
      helloScene: "Hello, {name}!",
      attendanceState: {
        unknown: "?",
        present: "Present",
        absent: "Absent"
      },
      transitionPanel: "Transition Panel",
      nowNextTitle: "Now / Next",
      add: "Add",
      delete: "Delete",
      schedule: "Schedule",
      students: "Students",
      transitionsEdit: "Transitions",
      dwellTime: "Dwell time",
      modeTouch: "Touch mode",
      modeDwell: "Dwell mode",
      helloMode: "Hello",
      attendanceMode: "Attendance",
      tapAnywhere: "Tap anywhere to advance",
      reset: "Reset",
      confirmExit: "Leave without saving?",
      toggle: "Toggle",
      momentary: "Momentary",
      durationMs: "Duration (ms)",
      audio: "Audio",
      label: "Label",
      behavior: "Behavior",
      nowLabel: "Now",
      nextLabel: "Next",
      advanceAction: "Advance",
      calmMessage: "Let’s breathe together",
      break: "Break"
    },
    ja: {
      hello: "あいさつ",
      attendance: "出席",
      transitions: "トランジション",
      now: "いま",
      next: "つぎ",
      advance: "すすむ",
      allDone: "おわり",
      edit: "編集",
      save: "保存",
      import: "インポート",
      export: "エクスポート",
      back: "戻る",
      dwell: "ホバー",
      touch: "タッチ",
      volume: "音量",
      mute: "ミュート",
      language: "言語",
      input: "入力",
      calmBreak: "リラックス",
      routineEngine: "ルーティン",
      helloAttendanceTitle: "あいさつ / 出席",
      transitionsTitle: "トランジション",
      scheduleTitle: "スケジュール",
      editTitle: "編集",
      addStudent: "児童を追加",
      addSchedule: "ステップを追加",
      addTransition: "トランジションを追加",
      saved: "保存しました",
      helloScene: "{name} さん、こんにちは！",
      attendanceState: {
        unknown: "?",
        present: "出席",
        absent: "欠席"
      },
      transitionPanel: "トランジションパネル",
      nowNextTitle: "いま / つぎ",
      add: "追加",
      delete: "削除",
      schedule: "スケジュール",
      students: "児童",
      transitionsEdit: "トランジション",
      dwellTime: "ホバー時間",
      modeTouch: "タッチモード",
      modeDwell: "視線モード",
      helloMode: "あいさつ",
      attendanceMode: "出席",
      tapAnywhere: "どこでもタップで進む",
      reset: "リセット",
      confirmExit: "保存せずに戻りますか？",
      toggle: "トグル",
      momentary: "一時",
      durationMs: "時間 (ms)",
      audio: "オーディオ",
      label: "ラベル",
      behavior: "動作",
      nowLabel: "いま",
      nextLabel: "つぎ",
      advanceAction: "すすむ",
      calmMessage: "いっしょに深呼吸",
      break: "きゅうけい"
    }
  };

  let current = localStorage.getItem('routine_language') || 'en';

  const setLanguage = lang => {
    current = lang;
    localStorage.setItem('routine_language', lang);
    document.documentElement.lang = lang;
  };

  const t = key => {
    const parts = key.split('.');
    let value = strings[current];
    for (const p of parts) value = value?.[p];
    return value ?? key;
  };

  const getStrings = () => strings[current];
  const getAll = () => strings;

  return { t, setLanguage, getStrings, getAll, current: () => current };
})();

export default I18N;
