<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chasse aux lettres - Mots illustrés</title>
  <link rel="stylesheet" href="../../css/games.css" />
  <link rel="stylesheet" href="../../css/choiceeyegaze.css" />
  <style>
    body {
      background: #f7fbfb;
      color: #062a2a;
      font-family: "Nunito", system-ui, sans-serif;
    }

    #langToggle {
      position: fixed;
      top: 10px;
      right: 10px;
      z-index: 20;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      border-radius: 10px;
      border: 2px solid #00897b;
      background: #fff;
      color: #00897b;
      font-weight: 700;
      cursor: pointer;
      user-select: none;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
    }

    main {
      width: 100%;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding: clamp(16px, 4vw, 40px) clamp(12px, 4vw, 40px);
      box-sizing: border-box;
    }

    .game-shell {
      width: min(1040px, 100%);
      display: flex;
      flex-direction: column;
      gap: clamp(18px, 4vw, 32px);
    }

    .prompt-card {
      display: grid;
      grid-template-columns: minmax(180px, 240px) 1fr;
      align-items: center;
      gap: clamp(16px, 3vw, 28px);
      padding: clamp(18px, 3vw, 28px);
      border-radius: 22px;
      border: 2px solid rgba(0, 137, 123, 0.24);
      background: linear-gradient(135deg, rgba(0, 150, 136, 0.18), rgba(0, 188, 212, 0.12));
      box-shadow: 0 20px 45px rgba(0, 0, 0, 0.08);
    }

    .prompt-media {
      width: 100%;
      position: relative;
      overflow: hidden;
      border-radius: 18px;
      background: #fff;
      border: 3px solid rgba(255, 255, 255, 0.8);
      box-shadow: inset 0 0 0 1px rgba(0, 137, 123, 0.18);
    }

    .prompt-media img {
      display: block;
      width: 100%;
      height: auto;
    }

    .prompt-text {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .prompt-sentence {
      margin: 0;
      font-size: clamp(1.35rem, 2.4vw, 1.8rem);
      font-weight: 700;
      line-height: 1.3;
      color: #023d3d;
    }

    .prompt-sentence span.highlight {
      color: #c62828;
    }

    .prompt-word {
      margin: 0;
      font-size: clamp(1.1rem, 2vw, 1.4rem);
      font-weight: 600;
      letter-spacing: 0.02em;
      text-transform: uppercase;
      color: #015e56;
    }

    .prompt-word .letter-highlight {
      color: #c62828;
    }

    .prompt-word .syllable {
      display: inline-block;
      padding: 2px 6px;
      border-radius: 8px;
      background: rgba(198, 40, 40, 0.08);
      margin-right: 4px;
    }

    .grid-wrapper {
      background: rgba(255, 255, 255, 0.92);
      border-radius: 24px;
      padding: clamp(16px, 3vw, 26px);
      border: 2px solid rgba(0, 137, 123, 0.12);
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.06);
    }

    .letter-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
      gap: clamp(12px, 2vw, 18px);
    }

    .letter-cell {
      position: relative;
      border-radius: 18px;
      padding: clamp(16px, 3vw, 22px) clamp(10px, 2vw, 18px);
      background: #ffffff;
      border: 3px solid rgba(0, 150, 136, 0.24);
      box-shadow: 0 10px 24px rgba(0, 0, 0, 0.05);
      font-size: clamp(1.6rem, 3vw, 2.2rem);
      font-weight: 800;
      color: #009688;
      text-align: center;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease, color 0.2s ease;
      user-select: none;
    }

    .letter-cell:active {
      transform: scale(0.96);
    }

    .letter-cell.correct {
      background: #c62828;
      color: #fff;
      border-color: rgba(198, 40, 40, 0.8);
      box-shadow: 0 14px 24px rgba(198, 40, 40, 0.25);
    }

    .letter-cell.wrong {
      background: #ffeeee;
      color: #d32f2f;
      border-color: rgba(211, 47, 47, 0.4);
    }

    .round-progress {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-weight: 600;
      color: #02645e;
    }

    .next-button {
      align-self: center;
      padding: 12px 24px;
      border-radius: 30px;
      border: none;
      background: linear-gradient(135deg, #009688, #00bcd4);
      color: #fff;
      font-size: 1.05rem;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 14px 40px rgba(0, 150, 136, 0.3);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      display: none;
    }

    .next-button:hover {
      transform: translateY(-1px);
      box-shadow: 0 18px 44px rgba(0, 188, 212, 0.35);
    }

    .next-button.visible {
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    @media (max-width: 640px) {
      .prompt-card {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <button id="langToggle" type="button">FR / EN</button>
  <main>
    <div class="game-shell">
      <section class="prompt-card" aria-live="polite">
        <div class="prompt-media">
          <img id="promptImage" src="" alt="Illustration du mot" />
        </div>
        <div class="prompt-text">
          <p class="prompt-sentence" id="promptSentence"></p>
          <p class="prompt-word" id="promptWord"></p>
          <div class="round-progress" id="roundProgress"></div>
        </div>
      </section>

      <section class="grid-wrapper">
        <div class="letter-grid" id="letterGrid" role="grid" aria-label="Lettres à sélectionner"></div>
      </section>

      <button id="nextButton" class="next-button" type="button">
        <span class="translate" data-fr="Mot suivant" data-en="Next word">Mot suivant</span>
      </button>
    </div>
  </main>

  <script>
    const rounds = [
      {
        letter: "A",
        word: { fr: "AVOCAT", en: "AVOCADO" },
        image: "../../images/pictos/avocado.png",
        prompt: {
          fr: "On cherche la lettre <span class=\"highlight\">A</span>, comme dans le mot <strong>avocat</strong> !",
          en: "Let\u2019s find the letter <span class=\"highlight\">A</span> in the word <strong>avocado</strong>!"
        },
        gridSize: 12,
        required: 3
      },
      {
        letter: "B",
        word: { fr: "BANANE", en: "BANANA" },
        image: "../../images/pictos/banana.png",
        prompt: {
          fr: "On cherche la lettre <span class=\"highlight\">B</span>, comme dans le mot <strong>banane</strong> !",
          en: "We are looking for the letter <span class=\"highlight\">B</span> in the word <strong>banana</strong>!"
        },
        gridSize: 12,
        required: 3
      },
      {
        letter: "C",
        word: { fr: "CHAT", en: "CAT" },
        image: "../../images/pictos/cat.png",
        prompt: {
          fr: "On cherche la lettre <span class=\"highlight\">C</span>, comme dans le mot <strong>chat</strong> !",
          en: "Let\u2019s find the letter <span class=\"highlight\">C</span> in the word <strong>cat</strong>!"
        },
        gridSize: 12,
        required: 3
      }
    ];

    const alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");
    let currentIndex = 0;
    let currentLang = "fr";
    let foundCount = 0;

    const promptImage = document.getElementById("promptImage");
    const promptSentence = document.getElementById("promptSentence");
    const promptWord = document.getElementById("promptWord");
    const roundProgress = document.getElementById("roundProgress");
    const letterGrid = document.getElementById("letterGrid");
    const nextButton = document.getElementById("nextButton");
    const langToggle = document.getElementById("langToggle");

    function shuffle(array) {
      const copy = array.slice();
      for (let i = copy.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [copy[i], copy[j]] = [copy[j], copy[i]];
      }
      return copy;
    }

    function updateProgress(round) {
      roundProgress.textContent = `${foundCount}/${round.required}`;
      const label = currentLang === "fr"
        ? `${foundCount} sur ${round.required} lettres trouvées`
        : `${foundCount} of ${round.required} letters found`;
      roundProgress.setAttribute("aria-label", label);
    }

    function buildGrid(round) {
      letterGrid.innerHTML = "";
      foundCount = 0;
      updateProgress(round);
      nextButton.classList.remove("visible");

      const pool = [];
      for (let i = 0; i < round.required; i++) {
        pool.push(round.letter);
      }
      while (pool.length < round.gridSize) {
        const randomLetter = alphabet[Math.floor(Math.random() * alphabet.length)];
        if (randomLetter !== round.letter) {
          pool.push(randomLetter);
        }
      }

      shuffle(pool).forEach((letter, idx) => {
        const cell = document.createElement("button");
        cell.className = "letter-cell";
        cell.textContent = letter;
        cell.setAttribute("role", "gridcell");
        cell.setAttribute("aria-label", `Lettre ${letter}`);
        cell.dataset.letter = letter;
        cell.addEventListener("click", () => handleChoice(cell, round));
        letterGrid.appendChild(cell);
      });
    }

    function handleChoice(cell, round) {
      if (cell.classList.contains("correct")) return;
      const value = cell.dataset.letter;
      if (value === round.letter) {
        cell.classList.remove("wrong");
        cell.classList.add("correct");
        foundCount += 1;
        updateProgress(round);
        if (foundCount >= round.required) {
          nextButton.classList.add("visible");
        }
      } else {
        cell.classList.add("wrong");
        setTimeout(() => cell.classList.remove("wrong"), 600);
      }
    }

    function renderRound() {
      const round = rounds[currentIndex];
      promptImage.src = round.image;
      promptImage.alt = currentLang === "fr"
        ? `Illustration pour ${round.word.fr}`
        : `Illustration for ${round.word.en}`;
      promptSentence.innerHTML = round.prompt[currentLang];

      const highlighted = round.word[currentLang]
        .split("")
        .map((char) =>
          char.toUpperCase() === round.letter
            ? `<span class="letter-highlight">${char}</span>`
            : `<span class="syllable">${char}</span>`
        )
        .join("");
      promptWord.innerHTML = highlighted;

      buildGrid(round);
    }

    function goToNextRound() {
      currentIndex = (currentIndex + 1) % rounds.length;
      renderRound();
    }

    langToggle.addEventListener("click", () => {
      currentLang = currentLang === "fr" ? "en" : "fr";
      document.documentElement.lang = currentLang;
      renderRound();
    });

    nextButton.addEventListener("click", goToNextRound);

    renderRound();
  </script>
</body>
</html>
