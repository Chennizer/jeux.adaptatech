<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Eye Gaze Story Prototype</title>
  <style>
    :root {
      color-scheme: dark;
      font-family: "Segoe UI", system-ui, -apple-system, BlinkMacSystemFont, "Helvetica Neue", sans-serif;
    }
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      min-height: 100vh;
      background: radial-gradient(circle at 20% 20%, #223449, #0a0d14 70%);
      color: #f4faff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    button {
      border: none;
      border-radius: 999px;
      padding: 0.85rem 1.8rem;
      font-size: 1rem;
      font-weight: 600;
      background: linear-gradient(135deg, #6ad1c9, #4a9ef0);
      color: #081621;
      cursor: pointer;
      box-shadow: 0 12px 32px rgba(12, 49, 76, 0.35);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    button:hover,
    button:focus {
      transform: translateY(-2px);
      box-shadow: 0 18px 36px rgba(10, 52, 82, 0.45);
      outline: none;
    }
    button:active {
      transform: translateY(0);
      box-shadow: 0 8px 22px rgba(10, 32, 52, 0.35);
    }
    .screen {
      position: fixed;
      inset: 0;
      display: grid;
      place-items: center;
      background: radial-gradient(circle at 20% 20%, rgba(16, 28, 42, 0.9), rgba(8, 12, 20, 0.96));
      padding: 3vw;
      transition: opacity 0.45s ease;
    }
    .screen.hidden {
      opacity: 0;
      pointer-events: none;
    }
    .card {
      width: min(960px, 92vw);
      aspect-ratio: 16 / 9;
      border-radius: 28px;
      overflow: hidden;
      position: relative;
      display: flex;
      flex-direction: column;
      background: rgba(12, 20, 35, 0.85);
      box-shadow: 0 32px 90px rgba(4, 13, 28, 0.65);
      border: 1px solid rgba(110, 210, 201, 0.2);
    }
    .card::before {
      content: "";
      position: absolute;
      inset: 0;
      background: var(--bg, linear-gradient(135deg, #1b3958, #0c1726));
      filter: saturate(1.05);
      z-index: 0;
      transform: scale(1.02);
    }
    .card::after {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(120deg, rgba(10, 12, 18, 0.35) 0%, rgba(8, 12, 20, 0.8) 55%, rgba(9, 11, 18, 0.95) 100%);
      z-index: 0;
    }
    .card > * {
      position: relative;
      z-index: 1;
    }
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.2rem 1.5rem 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      font-size: 0.9rem;
      color: rgba(234, 246, 255, 0.7);
    }
    .progress {
      display: flex;
      align-items: center;
      gap: 0.45rem;
    }
    .progress-dot {
      width: 10px;
      height: 10px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.15);
      transition: background 0.3s ease, transform 0.3s ease;
    }
    .progress-dot.active {
      background: #6ad1c9;
      transform: scale(1.2);
      box-shadow: 0 0 0 4px rgba(106, 209, 201, 0.25);
    }
    .card-body {
      flex: 1;
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 1.8rem;
      padding: 1.5rem 1.8rem 1.8rem;
    }
    .story-copy {
      display: flex;
      flex-direction: column;
      justify-content: center;
      gap: 1rem;
    }
    .story-copy h2 {
      margin: 0;
      font-weight: 700;
      font-size: clamp(1.4rem, 2vw + 1rem, 2.35rem);
      color: #fafdff;
      text-shadow: 0 8px 20px rgba(5, 12, 26, 0.6);
    }
    .story-copy p {
      margin: 0;
      font-size: clamp(1rem, 1.1vw + 0.9rem, 1.25rem);
      line-height: 1.55;
      color: rgba(235, 245, 252, 0.82);
      max-width: 32ch;
    }
    .story-target-area {
      position: relative;
      display: grid;
      place-items: center;
    }
    .target-instruction {
      text-align: center;
      font-size: 0.95rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: rgba(214, 235, 255, 0.65);
      margin-bottom: 0.8rem;
    }
    .look-target {
      width: clamp(160px, 22vw, 240px);
      aspect-ratio: 1;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(255,255,255,0.18) 0%, rgba(81, 169, 218, 0.28) 40%, rgba(26, 88, 132, 0.55) 100%);
      border: 2px solid rgba(92, 196, 236, 0.65);
      box-shadow: 0 18px 38px rgba(20, 58, 88, 0.6);
      display: grid;
      place-items: center;
      font-weight: 600;
      font-size: 1rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: rgba(245, 250, 255, 0.8);
      transition: transform 0.4s ease, box-shadow 0.4s ease;
    }
    .look-target.active {
      transform: scale(1.1);
      box-shadow: 0 24px 70px rgba(40, 125, 175, 0.75);
    }
    .look-progress {
      position: absolute;
      inset: 0;
      border-radius: inherit;
      border: 3px solid rgba(255,255,255,0.85);
      transform: scale(1.03);
      opacity: 0;
      transition: opacity 0.15s ease;
      mask: radial-gradient(circle, transparent 62%, black 66%);
    }
    .look-target.active .look-progress {
      opacity: 1;
    }
    .look-progress::before {
      content: "";
      position: absolute;
      inset: -3px;
      border-radius: inherit;
      border: 6px solid transparent;
      border-top-color: rgba(255,255,255,0.9);
      border-right-color: rgba(255,255,255,0.4);
      animation: sweep var(--duration, 3s) linear forwards;
    }
    @keyframes sweep {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    .card-footer {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      padding: 1rem 1.5rem 1.2rem;
      gap: 0.75rem;
    }
    .skip-btn {
      background: transparent;
      color: rgba(226, 241, 255, 0.65);
      border: 1px solid rgba(226, 241, 255, 0.3);
      padding: 0.65rem 1.1rem;
      border-radius: 14px;
      font-size: 0.95rem;
      letter-spacing: 0.06em;
      text-transform: uppercase;
    }
    .skip-btn:hover,
    .skip-btn:focus {
      color: #0b1d2f;
      background: rgba(220, 240, 255, 0.92);
    }
    .story-btn {
      font-size: 0.95rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }
    .game-wrapper {
      position: relative;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
    }
    iframe {
      flex: 1;
      border: 0;
      border-radius: 20px;
      background: #010409;
      box-shadow: inset 0 0 0 1px rgba(80, 120, 160, 0.3);
    }
    .game-overlay {
      position: absolute;
      inset: 0;
      display: grid;
      place-items: center;
      background: rgba(6, 12, 20, 0.82);
      backdrop-filter: blur(3px);
      color: #e8f6ff;
      text-align: center;
      padding: 2rem;
      gap: 1.2rem;
      transition: opacity 0.3s ease;
    }
    .game-overlay.hidden {
      opacity: 0;
      pointer-events: none;
    }
    .game-overlay h3 {
      margin: 0;
      font-size: clamp(1.2rem, 1.4vw + 1rem, 1.8rem);
      text-transform: uppercase;
      letter-spacing: 0.12em;
    }
    .game-overlay p {
      margin: 0;
      max-width: 34ch;
      font-size: 1.05rem;
      line-height: 1.55;
      color: rgba(230, 244, 255, 0.78);
    }
    .backdrop {
      position: fixed;
      inset: 0;
      background: rgba(3, 6, 12, 0.8);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 2.5rem;
      padding: 2.5rem;
      text-align: center;
    }
    .backdrop h1 {
      font-size: clamp(2rem, 3vw + 1rem, 2.8rem);
      letter-spacing: 0.12em;
      text-transform: uppercase;
      margin: 0;
    }
    .backdrop p {
      margin: 0 auto 1rem;
      max-width: 48ch;
      line-height: 1.6;
      font-size: 1.05rem;
      color: rgba(228, 242, 255, 0.75);
    }
    .label {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.4em;
      color: rgba(170, 210, 236, 0.6);
    }
    @media (max-width: 780px) {
      .card {
        aspect-ratio: auto;
        height: 100vh;
        border-radius: 0;
      }
      .card-body {
        grid-template-columns: 1fr;
        gap: 1rem;
        padding: 1.5rem;
      }
      .card-footer,
      .card-header {
        padding-left: 1.2rem;
        padding-right: 1.2rem;
      }
      .story-copy p {
        max-width: none;
      }
    }
  </style>
</head>
<body>
  <div id="menuScreen" class="backdrop">
    <span class="label">Prototype</span>
    <h1>Eye Gaze Story Journey</h1>
    <p>
      This prototype strings together placeholder story moments with existing
      eye-gaze mini games. Use a pointer to simulate gaze: hover over the glowing
      "focus" circle to advance through the story.
    </p>
    <button id="startStory">Enter Story</button>
  </div>

  <div id="storyScreen" class="screen hidden" aria-live="polite">
    <article class="card" role="group" aria-roledescription="story stage">
      <header class="card-header">
        <div id="stageLabel">Story Setup</div>
        <div class="progress" aria-hidden="true" id="progressDots"></div>
      </header>
      <section class="card-body" id="cardBody"></section>
      <footer class="card-footer" id="cardFooter"></footer>
    </article>
  </div>

  <script>
    const steps = [
      {
        type: "story",
        title: "Arrival in the Grove",
        text: "The wind carries the scent of blossoms as our guide invites you to follow the lantern-lit path.",
        background: "linear-gradient(135deg, #13253b 0%, #1a3d5c 45%, #0a1726 100%)",
      },
      {
        type: "game",
        title: "Cherry Blossom Garden",
        description: "Play the cherry blossom mini game. When you are ready to continue, select the button below to return to the story.",
        url: "../cherryblossom/index.html",
      },
      {
        type: "story",
        title: "Echoes of Breath",
        text: "A circle of stones surrounds a quiet pond. Your breathing matches the gentle ripples across the water.",
        background: "linear-gradient(135deg, #10182e 0%, #1b3757 55%, #05101f 100%)",
      },
      {
        type: "game",
        title: "Meditation Pool",
        description: "Take a moment to enjoy the meditation experience. When finished, return here using the button provided.",
        url: "../meditation/index.html",
      },
      {
        type: "story",
        title: "Lantern of Guidance",
        text: "A lantern floats into view, illuminating symbols that mark the path forward.",
        background: "linear-gradient(135deg, #141f33 0%, #27466c 50%, #091320 100%)",
      },
      {
        type: "game",
        title: "Lantern Vigil",
        description: "Focus on the lantern mini game. When you are ready for the final story moment, select the continue button.",
        url: "../lamp/index.html",
      },
      {
        type: "story",
        title: "Journey's Promise",
        text: "The path ahead glows softly. Tomorrow, the story will bloom with new choices and voices to meet.",
        background: "linear-gradient(135deg, #101d33 0%, #244268 50%, #0c1827 100%)",
      },
    ];

    const menuScreen = document.getElementById("menuScreen");
    const storyScreen = document.getElementById("storyScreen");
    const stageLabel = document.getElementById("stageLabel");
    const progressDots = document.getElementById("progressDots");
    const cardBody = document.getElementById("cardBody");
    const cardFooter = document.getElementById("cardFooter");
    const startStoryBtn = document.getElementById("startStory");

    let currentStep = 0;
    let dwellTimer = null;

    function buildProgress() {
      progressDots.innerHTML = "";
      steps.forEach((_, index) => {
        const dot = document.createElement("span");
        dot.className = "progress-dot";
        dot.dataset.index = index;
        progressDots.appendChild(dot);
      });
    }

    function updateProgress() {
      [...progressDots.children].forEach((dot, index) => {
        dot.classList.toggle("active", index === currentStep);
      });
    }

    function clearDwellTimer() {
      if (dwellTimer) {
        clearTimeout(dwellTimer);
        dwellTimer = null;
      }
    }

    function requestFullscreen() {
      const el = document.documentElement;
      if (!document.fullscreenElement && el.requestFullscreen) {
        el.requestFullscreen().catch(() => {});
      }
    }

    function renderStoryStep(step) {
      cardBody.innerHTML = "";
      cardFooter.innerHTML = "";
      cardBody.parentElement.style.setProperty("--bg", step.background || "");
      stageLabel.textContent = "Story Moment";

      const copy = document.createElement("div");
      copy.className = "story-copy";
      copy.innerHTML = `<h2>${step.title}</h2><p>${step.text}</p>`;

      const targetWrap = document.createElement("div");
      targetWrap.className = "story-target-area";
      targetWrap.innerHTML = `
        <div class="target-instruction">Focus on the glowing circle to continue</div>
        <div class="look-target" role="button" aria-label="Focus target">
          Focus
          <div class="look-progress"></div>
        </div>
      `;

      const skip = document.createElement("button");
      skip.className = "skip-btn";
      skip.type = "button";
      skip.textContent = "Skip Target";
      skip.addEventListener("click", () => advanceStep());

      const lookTarget = targetWrap.querySelector(".look-target");
      const dwellDuration = 1800;

      const startDwell = () => {
        lookTarget.classList.add("active");
        lookTarget.style.setProperty("--duration", `${dwellDuration}ms`);
        clearDwellTimer();
        dwellTimer = setTimeout(() => {
          lookTarget.classList.remove("active");
          advanceStep();
        }, dwellDuration);
      };

      const cancelDwell = () => {
        lookTarget.classList.remove("active");
        clearDwellTimer();
      };

      ["pointerenter", "focus"].forEach((evt) => {
        lookTarget.addEventListener(evt, startDwell);
      });
      ["pointerleave", "blur"].forEach((evt) => {
        lookTarget.addEventListener(evt, cancelDwell);
      });
      lookTarget.addEventListener("click", advanceStep);

      cardBody.append(copy, targetWrap);
      cardFooter.appendChild(skip);
    }

    function renderGameStep(step) {
      cardBody.innerHTML = "";
      cardFooter.innerHTML = "";
      cardBody.parentElement.style.setProperty("--bg", "linear-gradient(135deg, #071425, #0f233a)");
      stageLabel.textContent = "Mini Game";

      const wrapper = document.createElement("div");
      wrapper.className = "game-wrapper";
      const iframe = document.createElement("iframe");
      iframe.src = step.url;
      iframe.title = step.title;
      iframe.setAttribute("allow", "fullscreen");

      const overlay = document.createElement("div");
      overlay.className = "game-overlay";
      overlay.innerHTML = `
        <div>
          <h3>${step.title}</h3>
          <p>${step.description}</p>
        </div>
        <button class="story-btn" type="button">Open Mini Game</button>
      `;

      const continueBtn = document.createElement("button");
      continueBtn.className = "story-btn";
      continueBtn.type = "button";
      continueBtn.textContent = "Return to Story";
      continueBtn.addEventListener("click", () => {
        overlay.classList.remove("hidden");
        advanceStep();
      });

      const openBtn = overlay.querySelector("button");
      openBtn.addEventListener("click", () => {
        overlay.classList.add("hidden");
      });

      wrapper.append(iframe, overlay);
      cardBody.appendChild(wrapper);
      cardFooter.appendChild(continueBtn);
    }

    function advanceStep() {
      clearDwellTimer();
      currentStep = Math.min(currentStep + 1, steps.length - 1);
      renderStep();
    }

    function renderStep() {
      const step = steps[currentStep];
      updateProgress();
      if (step.type === "game") {
        renderGameStep(step);
      } else {
        renderStoryStep(step);
      }
      if (currentStep === steps.length - 1) {
        const doneBtn = document.createElement("button");
        doneBtn.className = "story-btn";
        doneBtn.type = "button";
        doneBtn.textContent = "Restart Journey";
        doneBtn.addEventListener("click", resetJourney);
        cardFooter.appendChild(doneBtn);
      }
    }

    function resetJourney() {
      currentStep = 0;
      renderStep();
      updateProgress();
    }

    startStoryBtn.addEventListener("click", () => {
      requestFullscreen();
      menuScreen.classList.add("hidden");
      storyScreen.classList.remove("hidden");
      buildProgress();
      renderStep();
    });

    document.addEventListener("keydown", (event) => {
      if (event.key === "ArrowRight" || event.key === " ") {
        advanceStep();
      }
    });
  </script>
</body>
</html>
