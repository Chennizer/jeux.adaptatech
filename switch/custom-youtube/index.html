<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title data-fr="Vidéos personnalisées" data-en="Custom Videos">Vidéos personnalisées youtube</title>

  <link rel="stylesheet" href="../../css/control-panel.css">
  <link rel="stylesheet" href="../../css/games.css">
  <link rel="stylesheet" href="../../css/layout.css">

  <style>
    :root{
      --teal:#00796B;
      --ctl-h:40px;
      --modal-pad-x:18px;
    }

    /* ========== Modal shell ========== */
    #video-selection-modal .modal-content{
      max-width:70vw;
      min-width:600px;
      max-height:80vh;
      background:#fff;
      padding:16px var(--modal-pad-x);
      display:flex;
      flex-direction:column;
      overflow:hidden;            /* only inner area scrolls */
    }
    #video-selection-modal h2{margin:0 0 8px;}

    /* Only the grid scrolls */
    #video-selection-modal #video-selection{
      flex:1 1 auto;
      overflow:auto;
      padding-right:4px;
      display:flex;
      justify-content:center;
      gap:16px;
      width:100%;
      flex-wrap:wrap;
      min-width:0;
      scrollbar-gutter: stable both-edges;
    }

    /* Sections + grid (cards unchanged) */
    #video-selection-modal .video-section{margin-bottom:10px;flex:1;min-width:300px;}
    #video-selection-modal .video-section-title{color:black;margin:10px 0 6px;}
    #video-selection-modal .video-list{
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(150px,1fr));
      gap:10px;
      margin-bottom:8px;
      width:100%;
    }

    /* ========== Footer (two rows) ========== */
    #video-selection-modal .footer-bar{
      position:sticky;
      bottom:0;
      background:#f7fbf9;
      border-top:1px solid #dcefed;
      margin-top:8px;
      padding:10px 0;
      display:grid;
      grid-template-rows:auto auto;   /* row 1: inputs | row 2: status + CTAs */
      row-gap:10px;
    }

    /* Row 1: two input groups */
    #video-selection-modal .footer-inputs{
      display:grid;
      grid-template-columns:minmax(0,1fr) minmax(0,1fr);
      column-gap:12px;
      align-items:center;
      min-width:0;
    }
    #video-selection-modal .input-group{
      display:grid;
      grid-template-columns:minmax(0,1fr) auto;
      gap:10px 12px;
      align-items:center;
      min-width:0;
    }

    /* Row 2: status left, buttons centered */
    #video-selection-modal .footer-actions{
      display:grid;
      grid-template-columns: 1fr auto 1fr;  /* left spacer/status | centered CTAs | right spacer */
      align-items:center;
      column-gap:12px;
      min-width:0;
    }
    #video-selection-modal .status-line{
      grid-column: 1 / 2;
      justify-self: start;
      font-size:13px;
      color:#333;
      min-height:18px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    #video-selection-modal .footer-cta{
      grid-column: 2 / 3;
      justify-self: center;          /* centered group */
      display:flex;
      gap:10px;
      align-items:center;
    }

    /* Responsive: stack input groups on small widths */
    @media (max-width: 960px){
      #video-selection-modal .footer-inputs{
        grid-template-columns:1fr;
        row-gap:10px;
      }
    }

    /* ========== Inputs & buttons ========== */
    #video-selection-modal .control-panel-input{
      height:var(--ctl-h);
      padding:0 12px 0 38px;
      font-size:16px;
      border:2px solid var(--teal);
      border-radius:999px;
      width:100%;
      box-sizing:border-box;
      background:#fff no-repeat 12px 50% / 18px 18px;
      min-width:0;
    }
    /* URL icon */
    #add-video-url-input{
      background-image:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='%2300796B' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><path d='M10 13a5 5 0 0 1 7.54-.54l2 2a5 5 0 0 1-7.07 7.07l-2-2'/><path d='M14 11a5 5 0 0 1-7.54.54l-2-2a5 5 0 0 1 7.07-7.07l2 2'/></svg>");
    }
    /* Playlist icon */
    #yt-playlist-url-input{
      background-image:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='%2300796B' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><line x1='3' y1='6' x2='14' y2='6'/><line x1='3' y1='12' x2='14' y2='12'/><line x1='3' y1='18' x2='9' y2='18'/><polygon points='16 14 22 18 16 22 16 14'/></svg>");
    }
    #video-selection-modal .control-panel-input:focus{
      outline:none;
      border-color:#015e53;
      box-shadow:0 0 0 3px rgba(0,121,107,.12);
    }

    #video-selection-modal .button{
      height:var(--ctl-h);
      padding:0 14px;
      border-radius:999px;
      margin:0;
      white-space:nowrap;
    }
    #video-selection-modal .button.outline{
      background:#fff;
      color:var(--teal);
      border:2px solid var(--teal);
    }
    #video-selection-modal .button.outline:hover{background:#f1fbf8;}
    #video-selection-modal .button.primary{
      background:var(--teal);
      color:#fff;
      border:2px solid var(--teal);
      padding:0 20px;
    }
    #video-selection-modal .button.danger{
      background:#fff;
      color:#b3261e;
      border:2px solid #b3261e;
    }
    #video-selection-modal .button.danger:hover{ background:#ffeceb; }

    /* ========== Cards (unchanged) ========== */
    #video-selection-modal .video-card{
      position:relative;
      display:flex;
      flex-direction:column;
      align-items:stretch;
      background:#fff;
      border:3px solid color-mix(in srgb, var(--teal) 25%, transparent);
      border-radius:12px;
      overflow:hidden;
      box-shadow:0 1px 2px rgba(0,0,0,.06);
      padding-bottom:6px;
      transition:border-color .15s ease, box-shadow .15s ease, background-color .15s ease, filter .15s ease, opacity .15s ease;
    }
    #video-selection-modal .video-card:hover{
      border-color:color-mix(in srgb, var(--teal) 35%, transparent);
    }
    #video-selection-modal .video-card.selected{
      border-color:var(--teal);
      box-shadow:0 0 0 3px color-mix(in srgb, var(--teal) 15%, transparent), 0 8px 20px rgba(0,0,0,.12);
      background:#f0fbf9;
      filter:none;
      opacity:1;
    }
    #video-selection-modal .video-card.deselected{
      border-color:#d1d5db;
      box-shadow:none;
      background:#f5f7fa;
      filter:grayscale(0.65);
      opacity:0.65;
    }
    #video-selection-modal .video-card.deselected:hover{
      border-color:#cbd5e1;
    }
    #video-selection-modal .video-card .thumb{
      display:block; width:100%; height:auto;
      aspect-ratio:16/9; object-fit:cover; border-bottom:1px solid #eee;
    }
    #video-selection-modal .video-card .thumb.placeholder{
      background:linear-gradient(180deg,#f2f4f7,#eaeef3);
    }
    #video-selection-modal .video-card .video-name{
      padding:10px 12px 14px;
      font-size:14px; line-height:1.35; color:#111;
      display:-webkit-box; -webkit-line-clamp:4; -webkit-box-orient:vertical;
      overflow:hidden; word-break:break-word; text-align:center;
    }
    #video-selection-modal .video-card .video-index{
      position:absolute; top:6px; left:6px;
      min-width:22px; height:22px; padding:0 6px;
      border-radius:999px; background:rgba(0,0,0,.75); color:#fff;
      font-size:12px; font-weight:700; line-height:22px; text-align:center;
      pointer-events:none; z-index:3;
    }
    #video-selection-modal .video-card .remove-btn{
      position:absolute; top:6px !important; right:6px !important;
      color:#c00; font-weight:900; cursor:pointer; font-size:22px; line-height:1;
      text-shadow:0 1px 2px rgba(0,0,0,.2); background:rgba(255,255,255,.95);
      border-radius:999px; width:26px; height:26px; display:flex; align-items:center; justify-content:center;
      z-index:4; box-shadow:0 1px 2px rgba(0,0,0,.12);
    }
    #video-selection-modal .video-card .remove-btn:hover{background:#fff; transform:scale(1.05);}
    #video-selection-modal .video-card .order-controls{
      position:absolute !important; right:6px !important; top:44px !important; bottom:auto !important;
      z-index:4; background:rgba(255,255,255,.95); border:1px solid #e5e7eb; border-radius:8px; padding:2px;
    }

    /* YouTube player host */
    #youtube-player{position:absolute;top:0;left:0;width:100%;height:100%;z-index:25;overflow:hidden;}
    #youtube-player iframe{width:100%;height:100%;pointer-events:none;}
  </style>
</head>

<!-- Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-B45TJG4GBJ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-B45TJG4GBJ');
</script>

<body data-media-type="video">
  <!-- Control Panel -->
  <div id="control-panel" style="background-image: url('../../images/ghibli/ghibliyoutube.png');">
    <div id="control-panel-options">
      <div id="control-panel-title" data-fr="Vidéos personnalisées youtube" data-en="Youtube custom Videos">
        Vidéos personnalisées youtube
      </div>
      <div id="control-panel-instructions"></div>

      <div id="options-grid">
        <div>
          <select id="control-panel-play-mode" class="control-panel-custom-select">
            <option value="" disabled selected data-fr="Mode de jeu" data-en="Game Mode">Mode de jeu</option>
            <option value="pressBetween" data-fr="Une fois par vidéo" data-en="Once per video">Une fois par vidéo</option>
            <option value="onePress" data-fr="Une fois par liste de lecture" data-en="Once per playlist">Une fois par liste de lecture</option>
            <option value="interval" data-fr="Intervalle" data-en="Interval">Intervalle</option>
          </select>
        </div>
        <div>
          <label for="interval-time" id="interval-label" style="display:none;"
            data-fr="Temps d'intervalle en secondes" data-en="Interval time in seconds">
            Temps d'intervalle en secondes
          </label>
          <input id="interval-time" type="number" value="30" style="display:none;">
        </div>
        <div>
          <button id="select-videos-button" class="button"
            data-fr="Sélection de vidéos" data-en="Video Selection">Sélection de vidéos</button>
        </div>
        <div>
          <select id="special-options-select" class="control-panel-custom-select"></select>
        </div>
        <div>
          <button id="select-space-prompt-button" class="button"
            data-fr="Image indicatrice" data-en="Indicator Image">Image indicatrice</button>
        </div>
        <div>
          <select id="sound-options-select" class="control-panel-custom-select">
            <option disabled selected hidden data-fr="Son indicateur" data-en="Indicator Sound">Son indicateur</option>
          </select>
        </div>
        <div style="display:none;" id="player2-prompt-container">
          <button id="select-space-prompt-button-2" class="button"
            data-fr="Image indicatrice du 2e joueur" data-en="Player 2 Indicator Image">
            Image indicatrice du 2e joueur
          </button>
        </div>
        <div style="display:none;" id="player2-sound-container">
          <select id="sound-options-select-2" class="control-panel-custom-select">
            <option disabled selected data-fr="Son indicateur du 2e joueur" data-en="Player 2 Indicator Sound">
              Son indicateur du 2e joueur
            </option>
          </select>
        </div>
      </div>

      <div>
        <button id="misc-options-button" class="button"
          data-fr="Options Diverses" data-en="Miscellaneous Options">Options Diverses</button>
      </div>
    </div>

    <div id="button-container">
      <div id="control-panel-loading-bar-container">
        <div id="control-panel-loading-bar"></div>
      </div>
      <button id="control-panel-start-button" class="button" style="display:none;"
        data-fr="Commencer" data-en="Start">Commencer</button>
    </div>
  </div>

  <!-- Misc Options Modal -->
  <div id="misc-options-modal" class="modal">
    <div class="modal-content">
      <span id="close-misc-options-modal" class="close">&times;</span>
      <h2 style="color:black" data-fr="Options Diverses" data-en="Miscellaneous Options">Options Diverses</h2>
      <div id="misc-options-container"></div>
      <button id="misc-options-ok-button" class="button" style="margin-top:15px;"
        data-fr="OK" data-en="OK">OK</button>
    </div>
  </div>

  <!-- Video Selection Modal -->
  <div id="video-selection-modal" class="modal">
    <div class="modal-content">
      <span id="close-modal" class="close">&times;</span>
      <h2 style="color:black"
          data-fr="Vidéos actives (cliquer pour sélectionner/désélectionner)"
          data-en="Active Videos (click to toggle)">Active Videos (click to toggle)</h2>

    <!-- Scrollable list -->
      <div id="video-selection">
        <div class="video-section" id="url-videos-section">
          <h3 class="video-section-title" data-fr="Vidéos par URL" data-en="URL Videos">URL Videos</h3>
          <div id="url-video-list" class="video-list"></div>
        </div>
      </div>

      <!-- Footer: row 1 inputs, row 2 status + centered CTAs -->
      <div class="footer-bar">
        <!-- Row 1 -->
        <div class="footer-inputs">
          <div class="input-group">
            <input id="add-video-url-input" type="text" placeholder="URL" class="control-panel-input">
            <button id="add-video-url-button" class="button outline" data-fr="Ajouter URL" data-en="Add URL">Add URL</button>
          </div>

          <div class="input-group">
            <input id="yt-playlist-url-input" type="text"
                   placeholder="URL de playlist (ex. https://www.youtube.com/playlist?list=...)"
                   class="control-panel-input">
            <button id="yt-playlist-import-button" class="button outline"
                    data-fr="Importer" data-en="Import">Import</button>
          </div>
        </div>

        <!-- Row 2 -->
        <div class="footer-actions">
          <div id="yt-playlist-status" class="status-line"></div>
          <div class="footer-cta">
            <button id="clear-all-button" class="button danger" data-fr="Tout effacer" data-en="Clear everything">Clear everything</button>
            <button id="ok-button" class="button primary" data-fr="OK" data-en="OK">OK</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Intro jingle -->
  <audio id="intro-jingle" src="../../sounds/pagestart.mp3" preload="auto"></audio>

  <!-- Record Modal -->
  <div id="record-modal" class="modal">
    <div class="modal-content">
      <span id="close-record-modal" class="close">&times;</span>
      <h3 style="color:black"
          data-fr="Enregistrez votre son indicateur. Autoriser l'utilisation du microphone par le navigateur."
          data-en="Record your indicator sound. Allow the browser to use the microphone.">
        Enregistrez votre son indicateur. Autoriser l'utilisation du microphone par le navigateur.
      </h3>
      <button id="record-button" class="button"
              data-fr="Enregistrer (maximum 5 secondes)"
              data-en="Record (max 5 seconds)">Enregistrer (maximum 5 secondes)</button>
      <button id="stop-recording-button" class="button" style="display:none;"
              data-fr="Stop" data-en="Stop">Stop</button>
      <p style="color:black" id="record-status"
         data-fr="Appuyer sur enregistrer pour commencer"
         data-en="Press record to start">Appuyer sur enregistrer pour commencer</p>
      <button id="ok-recording-button" class="button" style="display:none;"
              data-fr="OK" data-en="OK">OK</button>
    </div>
  </div>

  <!-- Space Prompt Selection Modals -->
  <div id="space-prompt-selection-modal" class="modal">
    <div class="modal-content">
      <span id="close-space-prompt-modal" class="close">&times;</span>
      <h2 style="color:black" data-fr="Sélectionner l'image indicatrice J1" data-en="Select indicator image for P1">
        Sélectionner l'image indicatrice J1
      </h2>
      <div id="space-prompt-selection"></div>
      <h3 style="color:black" data-fr="Remplacer l'image par du texte:" data-en="Replace image with text:">
        Remplacer l'image par du texte:
      </h3>
      <input type="text" id="text-prompt-input" placeholder="Texte personnalisé"
             style="width: 100%; padding: 10px; margin-top: 15px;" class="control-panel-input">
      <button id="apply-space-prompt" class="button" data-fr="OK" data-en="OK">OK</button>
    </div>
  </div>

  <div id="space-prompt-selection-modal-2" class="modal">
    <div class="modal-content">
      <span id="close-space-prompt-modal-2" class="close">&times;</span>
      <h2 style="color:black" data-fr="Sélectionner l'image indicatrice J2" data-en="Select indicator image for P2">
        Sélectionner l'image indicatrice J2
      </h2>
      <div id="space-prompt-selection-2"></div>
      <h3 style="color:black" data-fr="Remplacer l'image par du texte:" data-en="Replace image with text:">
        Remplacer l'image par du texte:
      </h3>
      <input type="text" id="text-prompt-input-2" placeholder="Texte personnalisé"
             style="width: 100%; padding: 10px; margin-top: 15px;" class="control-panel-input">
      <button id="apply-space-prompt-2" class="button" data-fr="OK" data-en="OK">OK</button>
    </div>
  </div>

  <!-- Player Names Modal -->
  <div id="player-names-modal" class="modal" style="display:none; position: fixed; z-index: 5000;
       top: 50%; left: 50%; transform: translate(-50%, -25%);">
    <div class="modal-content">
      <span id="close-player-names-modal" class="close">&times;</span>
      <h2 style="color:black;" data-fr="Entrez les noms des joueurs (facultatif)" data-en="Enter player names (optional)">
        Entrez les noms des joueurs (facultatif)
      </h2>
      <label style="color:black;" for="player1-name-input" data-fr="Joueur 1:" data-en="Player 1:">Joueur 1:</label>
      <input type="text" id="player1-name-input" style="width:50%; margin-bottom:10px;">
      <label style="color:black;" for="player2-name-input" data-fr="Joueur 2:" data-en="Player 2:">Joueur 2:</label>
      <input type="text" id="player2-name-input" style="width:50%; margin-bottom:10px;">
      <button id="player-names-ok-button" class="button" data-fr="OK" data-en="OK">OK</button>
      <button id="player-names-cancel-button" class="button" data-fr="Annuler" data-en="Cancel">Annuler</button>
    </div>
  </div>

  <div id="audio-container"></div>
  <div id="black-background" style="display:none;"></div>

  <img id="space-prompt" src="" alt="Press Space to Start" style="display:none;">
  <div id="text-prompt" style="display:none; font-size: 40px; text-align: center; color:aliceblue;"></div>
  <img id="space-prompt-2" src="" alt="Left Click to Continue" style="display:none;">
  <div id="text-prompt-2" style="display:none; font-size: 40px; text-align: center; color:aliceblue;"></div>

  <div id="video-container" style="display:none;">
    <video id="video-player" controls="false" crossorigin="anonymous">
      <source id="video-source" type="video/mp4">
      Your browser does not support the video tag.
    </video>
    <div id="youtube-player" style="display:none;width:100%;height:100%;pointer-events:none;"></div>
  </div>

  <!-- External JS -->
  <script src="https://www.youtube.com/iframe_api"></script>
  <script src="../../js/config.js"></script>
  <script src="../../js/switch-two-player-custom.js"></script>
  <script src="../../js/translationonly.js"></script>

    <script src="../../js/home-button.js" defer></script>
</body>
</html>
