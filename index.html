<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Portail de jeux</title>

  <link rel="stylesheet" href="css/global.css">
  <link rel="stylesheet" href="css/popup.css">
  <link rel="stylesheet" href="css/styleghibli.css">
  <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">

  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-B45TJG4GBJ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-B45TJG4GBJ');
  </script>

  <style>
    .hero-banner {
      width: 100%;
      height: auto;
      aspect-ratio: 1903 / 584;
      position: relative;
      overflow: hidden;
    }

    .hero-banner img{
      display: block;
      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: center;
    }

    .floating-button {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: #623B5A;
      color: white;
      border: none;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      font-size: 1.5em;
      cursor: pointer;
      z-index: 1000;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
    }

    .floating-button:hover {
      background-color: #D36135;
    }

    .floating-button.lang-ja-label {
      font-size: 1.3em;
    }

    .floating-button.lang-toggle {
      bottom: 90px;
    }

    /* Modal + overlay for news updates */
    #infoModal {
      display: none;
      position: fixed;
      top: 10%;
      left: 50%;
      transform: translateX(-50%);
      width: 80%;
      max-width: 600px;
      background: white;
      border-radius: 10px;
      padding: 20px;
      z-index: 1001;
      box-shadow: 0 4px 10px rgba(0,0,0,0.25);
    }

    #overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.4);
      z-index: 1000;
    }

    #closeModal {
      background-color: #D36135;
      border: none;
      padding: 10px 20px;
      color: white;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 20px;
    }

    /* --- Hover video preview inside the tile (NEW) --- */
    .tile-video-link{
      position: relative;
      display: block;
      overflow: hidden;
    }

    .tile-video-link > img{
      display: block;
      width: 100%;
      height: auto;
      position: relative;
      z-index: 1;
    }

    .tile-preview-video{
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: 2;
      opacity: 0;
      pointer-events: none;
      transition: opacity 180ms ease;
    }

    .tile-main-title{
      z-index: 3;
      position: absolute;
      left: 0;
      bottom: 0;
      width: 100%;
      backdrop-filter: blur(2px);
    }

    .tile-video-link.is-previewing .tile-preview-video{
      opacity: 1;
    }
  </style>
</head>
<body class="menu">
  <header class="hero-banner">
    <img src="images/banner0402.png" alt="BanniÃ¨re principale">
  </header>

  <!-- Call-to-Action Section -->
  <section class="cta">
    <h2 data-fr="RÃ©pertoire de jeux adaptÃ©s et d'activitÃ©s pour les Ã©lÃ¨ves polyhandicapÃ©s" data-en="Directory of adapted games and activities for students with multiple disabilities" data-ja="é‡è¤‡éšœå®³ã®ã‚ã‚‹å­¦ç¿’è€…ã®ãŸã‚ã®é©å¿œã‚²ãƒ¼ãƒ ã¨ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã®ä¸€è¦§">
      RÃ©pertoire de jeux adaptÃ©s et d'activitÃ©s pour les Ã©lÃ¨ves polyhandicapÃ©s
    </h2>

    <h3 data-fr="Jeux Ã©ducatifs conÃ§us pour switch adaptÃ©e, ainsi que pour Ã©cran tactile et contrÃ´le oculaire. Si vous ne savez pas de quoi il s'agit, rendez-vous <a class='antilicense-link' href='https://adaptatech.org/documentation/introduction/index.html' target='_blank'>ici pour une introduction</a>" data-en="Educational games designed for adapted switch, as well as for touchscreen and eye-gaze control. If you don't know what that is, please go read <a class='antilicense-link' href='https://adaptatech.org/documentation/introduction/index.html' target='_blank'>this introduction</a>" data-ja="é©å¿œã‚¹ã‚¤ãƒƒãƒã€ã‚¿ãƒƒãƒã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã€è¦–ç·šå…¥åŠ›ã«å¯¾å¿œã—ãŸæ•™è‚²ã‚²ãƒ¼ãƒ ã§ã™ã€‚è©³ã—ããªã„æ–¹ã¯<a class='antilicense-link' href='https://adaptatech.org/documentation/introduction/index.html' target='_blank'>ã“ã¡ã‚‰ã®å°å…¥ã‚¬ã‚¤ãƒ‰</a>ã‚’ã”è¦§ãã ã•ã„">
      Jeux Ã©ducatifs conÃ§us pour switch adaptÃ©e, ainsi que pour Ã©cran tactile et contrÃ´le oculaire
    </h3>
    <h3 data-fr="ActivitÃ©s conÃ§ues pour tous les Ã¢ges, tout en essayant d'accorder une attention particuliÃ¨re aux apprenants plus Ã¢gÃ©s" data-en="Activities designed for all ages, with special attention given to older learners" data-ja="ã‚ã‚‰ã‚†ã‚‹å¹´é½¢ã«å‘ã‘ãŸã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã§ã€ç‰¹ã«å¹´é•·ã®å­¦ç¿’è€…ã¸ã®é…æ…®ã‚’é‡è¦–ã—ã¦ã„ã¾ã™">
      ActivitÃ©s conÃ§ues pour tous les Ã¢ges, tout en essayant d'accorder une attention particuliÃ¨re aux apprenants plus Ã¢gÃ©s
    </h3>
    <h3 data-fr="Gratuit pour toujours, libre de tous droits, publiÃ© sous <a class='antilicense-link' href='https://unlicense.org/' target='_blank'>antilicense</a>" data-en="Forever free, public domain, published under <a class='antilicense-link' href='https://unlicense.org/' target='_blank'>unlicense</a>" data-ja="æ°¸é ã«ç„¡æ–™ã§ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãƒ‰ãƒ¡ã‚¤ãƒ³ã€<a class='antilicense-link' href='https://unlicense.org/' target='_blank'>ã‚¢ãƒ³ãƒ©ã‚¤ã‚»ãƒ³ã‚¹</a>ã®ä¸‹ã§å…¬é–‹ã—ã¦ã„ã¾ã™">
      Gratuit pour toujours, libre de tous droits, publiÃ© sous <a class="antilicense-link" href="https://unlicense.org/" target="_blank">antilicense</a>
    </h3>
  </section>

  <main class="main-content">
    <div class="tile-container-main">

      <div class="tile-main">
        <a href="switch/index.html" class="tile-video-link" data-video="animations/musicswitchvideo.mp4">
          <img src="images/ghibli/5yearswitch.png" alt="Switch Games">
          <div class="tile-main-title" data-fr="Jeux pour switch (musique et vidÃ©oclips)" data-en="Switch games (music and video clips)" data-ja="ã‚¹ã‚¤ãƒƒãƒç”¨ã‚²ãƒ¼ãƒ ï¼ˆéŸ³æ¥½ã¨ãƒ“ãƒ‡ã‚ªã‚¯ãƒªãƒƒãƒ—ï¼‰"></div>
        </a>
      </div>

      <div class="tile-main">
        <a href="pov/index.html" class="tile-video-link" data-video="animations/pov.mp4">
          <img src="images/ghibli/8yearswitch.png" alt="Switch Games">
          <div class="tile-main-title" data-fr="Jeux pour switch (POV)" data-en="Switch games (POV)" data-ja="ã‚¹ã‚¤ãƒƒãƒç”¨ã‚²ãƒ¼ãƒ ï¼ˆPOVï¼‰"></div>
        </a>
      </div>

      <div class="tile-main">
        <a href="gaming/index.html" class="tile-video-link" data-video="animations/othergames.mp4">
          <img src="images/ghibli/othergames.png" alt="gaming">
          <div class="tile-main-title" data-fr="Jeux pour switch (divers)" data-en="Switch games (various)" data-ja="ã‚¹ã‚¤ãƒƒãƒç”¨ã‚²ãƒ¼ãƒ ï¼ˆãã®ä»–ï¼‰"></div>
        </a>
      </div>

      <div class="tile-main">
        <a href="eyegaze/index.html" class="tile-video-link" data-video="animations/eyegaze.mp4">
          <img src="images/ghibli/ghiblieyegaze.png" alt="Eye Gaze Games">
          <div class="tile-main-title" data-fr="Jeux pour contrÃ´le oculaire" data-en="Eye control games" data-ja="è¦–ç·šå…¥åŠ›ã‚²ãƒ¼ãƒ "></div>
        </a>
      </div>

      <div class="tile-main">
        <a href="documentation/index.html" class="tile-video-link" data-video="animations/documentation.mp4">
          <img src="images/ghibli/ghiblidocumentation.png" alt="Instructions">
          <div class="tile-main-title" data-fr="Documentation" data-en="Documentation" data-ja="ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ"></div>
        </a>
      </div>

      <div class="tile-main">
        <a href="tactile/index.html" class="tile-video-link" data-video="animations/ghiblitactile.mp4">
          <img src="images/ghibli/ghiblitablette.png" alt="Jeux tactiles">
          <div class="tile-main-title" data-fr="Jeux pour Ã©crans tactiles" data-en="Touchscreen games" data-ja="ã‚¿ãƒƒãƒã‚¹ã‚¯ãƒªãƒ¼ãƒ³ç”¨ã‚²ãƒ¼ãƒ "></div>
        </a>
      </div>

      <div class="tile-main">
        <a href="pedagogique/index.html" class="tile-video-link" data-video="animations/pedagogie.mp4">
          <img src="images/ghibli/ghiblipedagogie.png" alt="pÃ©dagogique">
          <div class="tile-main-title" data-fr="Outils pÃ©dagogiques" data-en="Educational tools" data-ja="æ•™è‚²ç”¨ãƒ„ãƒ¼ãƒ«"></div>
        </a>
      </div>

      <div class="tile-main">
        <a href="resources/index.html" class="tile-video-link" data-video="animations/othergames.mp4">
          <img src="images/ghibli/othergames.png" alt="Ressources externes">
          <div class="tile-main-title" data-fr="Ressources externes" data-en="External resources" data-ja="å¤–éƒ¨ãƒªã‚½ãƒ¼ã‚¹"></div>
        </a>
      </div>

      <div class="tile-main">
        <a href="specialrequest/index.html" class="tile-video-link" data-video="animations/specialrequest.mp4">
          <img src="images/ghibli/ghiblispecialrequest.png" alt="gaming">
          <div class="tile-main-title" data-fr="ActivitÃ©s personnalisÃ©es (demandes spÃ©ciales)" data-en="Custom activity (special request)" data-ja="ã‚«ã‚¹ã‚¿ãƒ æ´»å‹•ï¼ˆç‰¹åˆ¥ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼‰"></div>
        </a>
      </div>

      <div class="tile-main">
        <a href="contact/index.html" class="tile-video-link" data-video="animations/contact.mp4">
          <img src="images/ghibli/ghiblicontact.png" alt="Contact">
          <div class="tile-main-title" data-fr="Contact" data-en="Contact" data-ja="ãŠå•ã„åˆã‚ã›"></div>
        </a>
      </div>

    </div>
  </main>

  <!-- Floating buttons: News + Language Toggle -->
  <button id="newsButton" class="floating-button" title="Mises Ã  jour">ğŸ“°</button>
  <button id="langToggle" class="floating-button lang-toggle" title="Changer la langue / Switch language">EN</button>

  <!-- Modal for Updates -->
  <div id="infoModal">
    <h2 data-fr="Mises Ã  jour" data-en="Updates" data-ja="æ›´æ–°æƒ…å ±">Mises Ã  jour</h2>
    <ul>
      <li data-fr="ActivitÃ© de choix disponible pour switch, Ã©cran tactile et contrÃ´le oculaire mise Ã  jour."
          data-en="Updated choice activity available for switch, touchscreen, and eye-gaze control."
          data-ja="ã‚¹ã‚¤ãƒƒãƒã€ã‚¿ãƒƒãƒã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã€è¦–ç·šå…¥åŠ›å‘ã‘ã®é¸æŠã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã‚’æ›´æ–°ã—ã¾ã—ãŸã€‚">
      </li>
    </ul>
    <button id="closeModal" data-fr="Fermer" data-en="Close" data-ja="é–‰ã˜ã‚‹">Fermer</button>
  </div>
  <div id="overlay"></div>

  <!-- Script to handle the modal for news -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const modal = document.getElementById('infoModal');
      const overlay = document.getElementById('overlay');
      const newsButton = document.getElementById('newsButton');
      const closeButton = document.getElementById('closeModal');

      newsButton.addEventListener('click', () => {
        modal.style.display = 'block';
        overlay.style.display = 'block';
      });

      closeButton.addEventListener('click', () => {
        modal.style.display = 'none';
        overlay.style.display = 'none';
      });

      overlay.addEventListener('click', () => {
        modal.style.display = 'none';
        overlay.style.display = 'none';
      });
    });
  </script>

  <!-- Script to handle language toggling, referencing translationMain.js -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const langBtn = document.getElementById('langToggle');
      langBtn.addEventListener('click', () => {
        toggleLanguage();
      });
    });
  </script>

  <!-- NEW: Hover video preview inside tile (single-active + strict hover/focus gating) -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const links = Array.from(document.querySelectorAll('.tile-video-link'));
      if (!links.length) return;

      const EXTRA_DELAY_AFTER_GROW_MS = 500;
      const FALLBACK_TOTAL_DELAY_MS = 800;

      const state = new WeakMap();
      let activeLink = null;

      const ensureVideoEl = (link) => {
        let vid = link.querySelector('.tile-preview-video');
        if (!vid) {
          vid = document.createElement('video');
          vid.className = 'tile-preview-video';
          vid.muted = true;
          vid.playsInline = true;
          vid.loop = true;
          vid.preload = 'metadata';
          vid.volume = 0.1;
          link.appendChild(vid);
        }
        return vid;
      };

      const stopPreview = (link) => {
        const s = state.get(link);
        if (!s) return;

        if (s.fallbackTimer) clearTimeout(s.fallbackTimer);
        if (s.afterGrowTimer) clearTimeout(s.afterGrowTimer);

        if (s.tile && s.onGrowEnd) {
          s.tile.removeEventListener('transitionend', s.onGrowEnd);
        }

        const vid = s.video;
        if (vid) {
          try { vid.pause(); } catch(e) {}
          vid.removeAttribute('src');
          vid.load();
        }

        link.classList.remove('is-previewing');
        state.delete(link);

        if (activeLink === link) activeLink = null;
      };

      const startPreview = (link) => {
        const videoSrc = link.dataset.video;
        if (!videoSrc) return;

        if (activeLink && activeLink !== link) {
          stopPreview(activeLink);
        }
        activeLink = link;

        const s = state.get(link) || {};
        const vid = ensureVideoEl(link);
        s.video = vid;
        state.set(link, s);

        let hasTriggered = false;

        const canTriggerNow = () => {
          const st = state.get(link);
          if (!st) return false;
          if (activeLink !== link) return false;
          if (!(st.isHovering || st.isFocused)) return false;
          return true;
        };

        const trigger = () => {
          if (hasTriggered) return;
          if (!canTriggerNow()) return;

          hasTriggered = true;

          link.classList.add('is-previewing');
          vid.src = videoSrc;
          vid.currentTime = 0;

          const p = vid.play();
          if (p && typeof p.then === 'function') {
            p.catch(() => {
              link.classList.remove('is-previewing');
            });
          }
        };

        const tile = link.closest('.tile-main') || link;
        s.tile = tile;

        const onGrowEnd = (ev) => {
          if (ev.propertyName !== 'transform') return;
          tile.removeEventListener('transitionend', onGrowEnd);
          s.onGrowEnd = null;

          s.afterGrowTimer = setTimeout(() => {
            trigger();
          }, EXTRA_DELAY_AFTER_GROW_MS);
        };
        s.onGrowEnd = onGrowEnd;

        tile.addEventListener('transitionend', onGrowEnd);

        s.fallbackTimer = setTimeout(() => {
          trigger();
        }, FALLBACK_TOTAL_DELAY_MS);
      };

      links.forEach((link) => {
        link.addEventListener('pointerenter', (e) => {
          if (e.pointerType && e.pointerType !== 'mouse') return;

          const s = state.get(link) || {};
          s.isHovering = true;
          s.isFocused = s.isFocused || false;
          state.set(link, s);

          startPreview(link);
        });

        link.addEventListener('pointerleave', () => {
          const s = state.get(link);
          if (s) s.isHovering = false;
          stopPreview(link);
        });

        link.addEventListener('focus', () => {
          const s = state.get(link) || {};
          s.isFocused = true;
          s.isHovering = s.isHovering || false;
          state.set(link, s);

          startPreview(link);
        });

        link.addEventListener('blur', () => {
          const s = state.get(link);
          if (s) s.isFocused = false;
          stopPreview(link);
        });

        link.addEventListener('click', () => stopPreview(link));
      });
    });
  </script>

  <script src="js/translationmain.js"></script>
</body>
</html>
